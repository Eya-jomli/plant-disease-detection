{% include "../navbackoffice.html" %}


{% block content %}
<div class="container my-5">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <h1 class="text-center">
        {% if plante %}Modifier la plante{% else %}Ajouter une nouvelle plante{% endif %}
      </h1>
     
      <form method="POST" enctype="multipart/form-data" class="mt-4">
        {% csrf_token %}
       
        <!-- Plant Name Field -->
        <div class="form-group mb-3">
          <label for="id_nom" class="form-label">Nom de la plante</label>
          {{ form.nom }}
          <small class="form-text text-muted">Enter the name of the plant.</small>
        </div>


        <!-- Description Field with Generate Button -->
        <div class="form-group mb-3">
          <label for="id_description" class="form-label">Description de la plante</label>
          {{ form.description }}
          <small class="form-text text-muted">A brief summary of the plant.</small>
        </div>
       
        <!-- Generate Description Button -->
        <button type="button" class="btn btn-secondary mb-3" id="generate-description-btn">
          Generate Description
        </button>


        <!-- Image Upload Field -->
        <div class="form-group mb-3">
          <label for="id_image" class="form-label">Upload Image</label>
          {{ form.image }}
        </div>


        <!-- Save Button -->
        <button type="submit" class="btn btn-primary btn-block">Enregistrer</button>
      </form>
    </div>
  </div>
</div>


<script>
  document.getElementById('generate-description-btn').addEventListener('click', function() {
    const nom = document.getElementById('id_nom').value;


    if (nom.trim() === '') {
        alert('Please enter the name of the plant (Nom de la plante).');
        return;
    }


    // AJAX call to generate description
    fetch("/generate_description/", {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}',
        },
        body: JSON.stringify({ nom: nom })
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(data => {
        if (data.description) {
            document.getElementById('id_description').value = data.description;
        } else {
            alert('Error: Unable to generate description');
        }
    })
    .catch(error => console.error('Error:', error));
});


</script>
{% endblock %}



